<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ß–æ–π—Ö–æ–Ω–∞</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>üìä –ß–æ–π—Ö–æ–Ω–∞</h1>
            <p class="subtitle">–ì—Ä—É–ø–ø–∞ 13 –£–ª—Ñ–∞—Ç–ª–∞—Ä</p>
        </header>

        <main class="main-content">
            <!-- –¢–∞–±–ª–∏—Ü–∞ –≤—Å–µ—Ö –ª—é–¥–µ–π -->
            <section class="section all-people-section">
                <h2>üë•–°–ø–∏—Å–æ–∫</h2>
                <div class="people-table">
                    <div class="table-header">
                        <div class="table-cell">–ò—Å–º–∏</div>
                        <div class="table-cell">–ö–µ–º–∞–≥–∞–Ω</div>
                        <div class="table-cell">–°—É–º–º–∞</div>
                        <div class="table-cell">–¢—É–ª–∞–Ω–¥–∏</div>
                        <div class="table-cell">–°—Ç–∞—Ç—É—Å</div>
                    </div>
                    <% stats.forEach(stat => { %>
                        <div class="table-row <% if (stat.totalAbsences === 0) { %>no-absence<% } %> <% if (stat.remainingDebt === 0) { %>all-paid<% } %>">
                            <div class="table-cell table-name"><%= stat.name %></div>
                            <div class="table-cell"><%= stat.totalAbsences %></div>
                            <div class="table-cell"><%= stat.totalDebtAmount %> —Ç–≥</div>
                            <div class="table-cell"><%= stat.paidAmount %> —Ç–≥</div>
                            <div class="table-cell"><% if (stat.remainingDebt > 0) { %><%= stat.remainingDebt %> —Ç–≥<% } else if (stat.overpayment > 0) { %>+<%= stat.overpayment %> —Ç–≥<% } else { %>‚úÖ –û–ø–ª–∞—á–µ–Ω–æ<% } %></div>
                        </div>
                    <% }); %>
                </div>
            </section>

            <!-- –ò—Å—Ç–æ—Ä–∏—è –ø—Ä–æ–ø—É—Å–∫–æ–≤ –ø–æ –ª—é–¥—è–º -->
            <section class="section history-section">
                <h2>üìÖ –ò—Å—Ç–æ—Ä–∏—è </h2>
                
                <% if (stats.length === 0) { %>
                    <p class="empty-message">–ü–æ–∫–∞ –Ω–µ—Ç –∑–∞–ø–∏—Å–µ–π –æ –ø—Ä–æ–ø—É—Å–∫–∞—Ö</p>
                <% } else { %>
                    <div class="history-list">
                        <% stats.forEach(stat => { %>
                            <% if (stat.totalAbsences > 0) { %>
                                <div class="history-item">
                                    <button type="button" class="history-button" onclick="toggleDates(this, '<%= stat.name %>')">
                                        <span class="history-name"><%= stat.name %></span>
                                        <span class="history-count"><%= stat.totalAbsences %> —Ä–∞–∑</span>
                                        <span class="history-sum">üí∞ <%= stat.totalDebtAmount %> —Ç–≥</span>
                                        <% if (stat.paidAmount > 0) { %>
                                            <span class="paid-badge">‚úÖ –¢—É–ª–∞–Ω–¥–∏ <%= stat.paidAmount %> —Ç–≥</span>
                                        <% } %>
                                        <% if (stat.overpayment > 0) { %>
                                            <span class="paid-badge" style="background: #f1c40f; color: #000;">‚ö†Ô∏è –û—Ä—Ç–∏“õ—á–∞ <%= stat.overpayment %> —Ç–≥</span>
                                        <% } %>
                                        <span class="toggle-icon">‚ñº</span>
                                    </button>
                                    <div class="history-dates" style="display: none;">
                                        <ul class="dates-list">
                                            <% const personAbsences = absences.filter(a => a.name === stat.name).sort((a, b) => new Date(b.date) - new Date(a.date)); %>
                                            <% personAbsences.forEach(absence => { %>
                                                <li class="date-item">
                                                    <span class="date-value"><%= new Date(absence.date + 'T00:00:00').toLocaleDateString('ru-RU', { weekday: 'short', year: 'numeric', month: 'short', day: 'numeric' }) %></span>
                                                    <span class="amount">2000 —Ç–≥</span>
                                                </li>
                                            <% }); %>
                                        </ul>
                                    </div>
                                </div>
                            <% } %>
                        <% }); %>
                    </div>
                <% } %>
            </section>

            <!-- –ò—Ç–æ–≥–æ –ø–æ –ø–ª–∞—Ç–µ–∂–∞–º -->
            <section class="section total-section">
                <h2>üíµ –§–∏–Ω–∞–Ω—Å–æ–≤—ã–π –æ—Ç—á–µ—Ç</h2>
                <div class="total-info">
                    <div class="total-card total-debt">
                        <div class="total-label">–ù—É–∂–Ω–æ —Å–æ–±—Ä–∞—Ç—å:</div>
                        <div class="total-value"><%= totalDebt %> —Ç–≥</div>
                    </div>
                    <div class="total-card in-cash">
                        <div class="total-label">–í –∫–∞—Å—Å–µ:</div>
                        <div class="total-value"><%= cashBalance %> —Ç–≥</div>
                    </div>
                    <div class="total-card expenses-total">
                        <div class="total-label">–†–∞—Å—Ö–æ–¥—ã:</div>
                        <div class="total-value"><%= totalExpenses %> —Ç–≥</div>
                    </div>
                </div>

                <!-- –ö–∞—Å—Å–∞ - –∫—Ç–æ –æ–ø–ª–∞—Ç–∏–ª -->
                <h3 class="cash-title">üí≥ –ö–∞—Å—Å–∞ (—Å–ø–∏—Å–æ–∫ –ø–ª–∞—Ç–µ–∂–µ–π)</h3>
                <% if (payments.length === 0) { %>
                    <p class="empty-message">–ù–∏–∫—Ç–æ –µ—â–µ –Ω–µ –æ–ø–ª–∞—Ç–∏–ª</p>
                <% } else { %>
                    <div class="payments-list">
                        <% payments.forEach(payment => { %>
                            <div class="payment-item">
                                <span class="payment-name">‚úÖ <%= payment.name %></span>
                                <span class="payment-amount"><%= payment.amount %> —Ç–≥</span>
                                <span class="payment-detail">(<%= payment.date %>)</span>
                            </div>
                        <% }); %>
                    </div>
                <% } %>
            </section>
        </main>

        <footer class="footer-links">
            <% if (isAdmin) { %>
                <a href="/admin" class="btn btn-primary btn-small">–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</a>
                <a href="/admin-logout" class="btn btn-danger btn-small">–í—ã—Ö–æ–¥</a>
            <% } else { %>
                <a href="/admin-login" class="btn btn-secondary btn-small">–ö–∞—Ç—Ç–∞ –ë–æ–ª–ª–∞—Ä</a>
            <% } %>
        </footer>
    </div>

    <script src="/js/app.js"></script>
</body>
</html>
